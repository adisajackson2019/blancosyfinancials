<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blancosy Financials - Interactive Dashboard</title>
    
    <!-- CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .dashboard-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            margin: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }
        .hero-section {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
        }
        .controls-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .metric-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border-left: 5px solid;
        }
        .metric-card:hover {
            transform: translateY(-5px);
        }
        .metric-card.success { border-left-color: #28a745; }
        .metric-card.info { border-left-color: #17a2b8; }
        .metric-card.primary { border-left-color: #007bff; }
        .metric-card.warning { border-left-color: #ffc107; }
        
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            min-height: 450px;
        }
        .chart-title {
            color: #2c3e50;
            font-weight: 600;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ecf0f1;
        }
        .control-group {
            margin-bottom: 20px;
        }
        .control-label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            display: block;
        }
        .form-select, .form-control {
            border-radius: 10px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }
        .form-select:focus, .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        .btn-custom {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .btn-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            color: white;
        }
        .comparison-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 15px;
            z-index: 10;
        }
        .year-badge {
            font-size: 1.1em;
            padding: 8px 16px;
            border-radius: 20px;
            margin: 5px;
        }
        .active-year {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .inactive-year {
            background: #e9ecef;
            color: #6c757d;
        }
        .update-notice {
            background: #d1ecf1;
            color: #0c5460;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Update Notice -->
        <div class="update-notice">
            <h6><i class="fas fa-info-circle me-2"></i>Data Updated</h6>
            <p class="mb-0">2025 Transport expenses updated to include KES 77,000. All calculations and charts reflect the latest data.</p>
        </div>

        <!-- Hero Section -->
        <div class="hero-section">
            <h1 class="display-4 fw-bold mb-3">
                <i class="fas fa-chart-line me-3"></i>Blancosy Financials
            </h1>
            <p class="lead mb-4">Interactive Financial Analysis Dashboard</p>
            <div class="row">
                <div class="col-md-4">
                    <span class="badge bg-light text-dark fs-6 mb-2">
                        <i class="fas fa-calendar me-2"></i>Multi-Year Analysis
                    </span>
                </div>
                <div class="col-md-4">
                    <span class="badge bg-success fs-6 mb-2">
                        <i class="fas fa-check-circle me-2"></i>Updated 2025 Data
                    </span>
                </div>
                <div class="col-md-4">
                    <span class="badge bg-info fs-6 mb-2">
                        <i class="fas fa-chart-bar me-2"></i>Interactive Controls
                    </span>
                </div>
            </div>
        </div>

        <!-- Interactive Controls -->
        <div class="controls-section">
            <h4 class="mb-4"><i class="fas fa-sliders-h me-2"></i>Dashboard Controls</h4>
            <div class="row">
                <div class="col-md-3">
                    <div class="control-group">
                        <label class="control-label">Select Year</label>
                        <select id="yearSelect" class="form-select">
                            <option value="2024">2024 (Official P&L)</option>
                            <option value="2025">2025 (Updated Data)</option>
                            <option value="both">Compare Both Years</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="control-group">
                        <label class="control-label">Chart Type</label>
                        <select id="chartTypeSelect" class="form-select">
                            <option value="waterfall">Waterfall Analysis</option>
                            <option value="pie">Expense Breakdown</option>
                            <option value="bar">Category Comparison</option>
                            <option value="line">Trend Analysis</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="control-group">
                        <label class="control-label">Expense Filter</label>
                        <select id="expenseFilter" class="form-select">
                            <option value="all">All Expenses</option>
                            <option value="operating">Operating Only</option>
                            <option value="cogs">COGS Only</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="control-group">
                        <label class="control-label">View Mode</label>
                        <select id="viewMode" class="form-select">
                            <option value="amount">Amount (KES)</option>
                            <option value="percentage">Percentage (%)</option>
                            <option value="both">Amount + Percentage</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-12">
                    <button id="updateCharts" class="btn btn-custom me-3">
                        <i class="fas fa-sync-alt me-2"></i>Update Charts
                    </button>
                    <button id="resetFilters" class="btn btn-outline-secondary">
                        <i class="fas fa-undo me-2"></i>Reset Filters
                    </button>
                    <div class="float-end">
                        <span class="year-badge active-year" id="year2024Badge">2024</span>
                        <span class="year-badge inactive-year" id="year2025Badge">2025</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dynamic Metrics -->
        <div class="row mb-4" id="metricsRow">
            <div class="col-md-3">
                <div class="metric-card success">
                    <div class="text-center">
                        <i class="fas fa-dollar-sign fa-3x text-success mb-3"></i>
                        <h3 class="text-success" id="salesMetric">KES 22,619,122</h3>
                        <p class="mb-0 fw-bold">Sales Revenue</p>
                        <small class="text-muted" id="salesSubtext">2024 Official</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="metric-card info">
                    <div class="text-center">
                        <i class="fas fa-chart-pie fa-3x text-info mb-3"></i>
                        <h3 class="text-info" id="grossProfitMetric">KES 5,374,558</h3>
                        <p class="mb-0 fw-bold">Gross Profit</p>
                        <small class="text-muted" id="grossMarginSubtext">23.8% Margin</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="metric-card primary">
                    <div class="text-center">
                        <i class="fas fa-trophy fa-3x text-primary mb-3"></i>
                        <h3 class="text-primary" id="netProfitMetric">KES 3,389,075</h3>
                        <p class="mb-0 fw-bold">Net Profit</p>
                        <small class="text-muted" id="netMarginSubtext">15.0% Margin</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="metric-card warning">
                    <div class="text-center">
                        <i class="fas fa-coins fa-3x text-warning mb-3"></i>
                        <h3 class="text-warning" id="expensesMetric">KES 1,985,483</h3>
                        <p class="mb-0 fw-bold">Operating Expenses</p>
                        <small class="text-muted" id="expensesSubtext">8.8% of Sales</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Year Comparison Section -->
        <div class="comparison-section" id="comparisonSection" style="display: none;">
            <h5><i class="fas fa-balance-scale me-2"></i>Year-over-Year Comparison</h5>
            <div class="row">
                <div class="col-md-6">
                    <h6>2024 Performance</h6>
                    <ul class="list-unstyled">
                        <li><i class="fas fa-arrow-up text-success me-2"></i>Sales: KES 22,619,122</li>
                        <li><i class="fas fa-chart-line text-info me-2"></i>Net Profit: KES 3,389,075</li>
                        <li><i class="fas fa-percentage text-primary me-2"></i>Profit Margin: 15.0%</li>
                        <li><i class="fas fa-truck text-warning me-2"></i>Transport: KES 1,028,770</li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <h6>2025 Performance (Updated)</h6>
                    <ul class="list-unstyled">
                        <li><i class="fas fa-arrow-down text-danger me-2"></i>Sales: KES 5,604,149</li>
                        <li><i class="fas fa-chart-line text-info me-2"></i>Net Profit: KES 2,005,322</li>
                        <li><i class="fas fa-percentage text-primary me-2"></i>Profit Margin: 35.8%</li>
                        <li><i class="fas fa-truck text-success me-2"></i>Transport: KES 77,000 <span class="badge bg-info">Updated</span></li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Dynamic Chart -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="chart-container">
                    <h4 class="chart-title" id="chartTitle">
                        <i class="fas fa-chart-bar me-2"></i>2024 P&L Waterfall Analysis
                    </h4>
                    <div id="dynamicChart" style="position: relative;">
                        <div class="loading-overlay">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Interactive Data Table -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="chart-container">
                    <h4 class="chart-title">
                        <i class="fas fa-table me-2"></i>Financial Data Explorer (Updated 2025 Transport)
                    </h4>
                    <div class="table-responsive">
                        <table class="table table-hover" id="dataTable">
                            <thead class="table-dark">
                                <tr>
                                    <th>Category</th>
                                    <th>2024 Amount</th>
                                    <th>2025 Amount</th>
                                    <th>Change</th>
                                    <th>% of Sales (2024)</th>
                                    <th>% of Sales (2025)</th>
                                </tr>
                            </thead>
                            <tbody id="dataTableBody">
                                <!-- Dynamic content -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>
    
    <script>
        // Financial data with updated 2025 transport
        const financialData = {
  "2024": {
    "sales": 22619122,
    "cogs": 17244564,
    "labour": 601155,
    "rent": 192000,
    "transport": 1028770,
    "transaction_costs": 163557.65,
    "gross_profit": 5374558,
    "total_operating_expenses": 1985482.65,
    "net_profit": 3389075.35,
    "gross_margin": 23.761125652887852,
    "net_margin": 14.98323122356385
  },
  "2025": {
    "sales": 5604149,
    "cogs": 3162735,
    "labour": 239092,
    "rent": 70000,
    "transport": 77000,
    "transaction_costs": 50000,
    "gross_profit": 2441414,
    "total_operating_expenses": 436092,
    "net_profit": 2005322,
    "gross_margin": 43.56440201714837,
    "net_margin": 35.782810200085684
  },
  "categories": [
    "Labour",
    "Rent",
    "Transport",
    "Transaction Costs"
  ],
  "expense_types": [
    "Operating Expenses",
    "Cost of Goods Sold",
    "All Expenses"
  ]
};
        
        let currentYear = '2024';
        let currentChartType = 'waterfall';
        let currentExpenseFilter = 'all';
        let currentViewMode = 'amount';
        
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            updateDashboard();
            populateDataTable();
            
            // Show update notice for 3 seconds
            setTimeout(() => {
                const notice = document.querySelector('.update-notice');
                if (notice) {
                    notice.style.transition = 'opacity 0.5s ease';
                    notice.style.opacity = '0';
                    setTimeout(() => notice.style.display = 'none', 500);
                }
            }, 5000);
        });
        
        function setupEventListeners() {
            document.getElementById('yearSelect').addEventListener('change', function() {
                currentYear = this.value;
                updateYearBadges();
                updateDashboard();
            });
            
            document.getElementById('chartTypeSelect').addEventListener('change', function() {
                currentChartType = this.value;
                updateChart();
            });
            
            document.getElementById('expenseFilter').addEventListener('change', function() {
                currentExpenseFilter = this.value;
                updateChart();
            });
            
            document.getElementById('viewMode').addEventListener('change', function() {
                currentViewMode = this.value;
                updateChart();
            });
            
            document.getElementById('updateCharts').addEventListener('click', function() {
                updateDashboard();
            });
            
            document.getElementById('resetFilters').addEventListener('click', function() {
                resetFilters();
            });
        }
        
        function updateYearBadges() {
            const badge2024 = document.getElementById('year2024Badge');
            const badge2025 = document.getElementById('year2025Badge');
            
            if (currentYear === '2024') {
                badge2024.className = 'year-badge active-year';
                badge2025.className = 'year-badge inactive-year';
            } else if (currentYear === '2025') {
                badge2024.className = 'year-badge inactive-year';
                badge2025.className = 'year-badge active-year';
            } else {
                badge2024.className = 'year-badge active-year';
                badge2025.className = 'year-badge active-year';
            }
        }
        
        function updateDashboard() {
            updateMetrics();
            updateChart();
            updateComparison();
        }
        
        function updateMetrics() {
            const data = currentYear === 'both' ? financialData['2024'] : financialData[currentYear];
            const yearText = currentYear === 'both' ? '2024 vs 2025' : currentYear;
            
            document.getElementById('salesMetric').textContent = `KES ${data.sales.toLocaleString()}`;
            document.getElementById('salesSubtext').textContent = `${yearText} Sales`;
            
            document.getElementById('grossProfitMetric').textContent = `KES ${data.gross_profit.toLocaleString()}`;
            document.getElementById('grossMarginSubtext').textContent = `${data.gross_margin.toFixed(1)}% Margin`;
            
            document.getElementById('netProfitMetric').textContent = `KES ${data.net_profit.toLocaleString()}`;
            document.getElementById('netMarginSubtext').textContent = `${data.net_margin.toFixed(1)}% Margin`;
            
            document.getElementById('expensesMetric').textContent = `KES ${data.total_operating_expenses.toLocaleString()}`;
            document.getElementById('expensesSubtext').textContent = `${(data.total_operating_expenses/data.sales*100).toFixed(1)}% of Sales`;
        }
        
        function updateComparison() {
            const comparisonSection = document.getElementById('comparisonSection');
            comparisonSection.style.display = currentYear === 'both' ? 'block' : 'none';
        }
        
        function updateChart() {
            const chartTitle = document.getElementById('chartTitle');
            const chartTitles = {
                'waterfall': 'P&L Waterfall Analysis',
                'pie': 'Expense Breakdown',
                'bar': 'Category Comparison',
                'line': 'Trend Analysis'
            };
            
            const yearText = currentYear === 'both' ? 'Multi-Year' : currentYear;
            chartTitle.innerHTML = `<i class="fas fa-chart-bar me-2"></i>${yearText} ${chartTitles[currentChartType]}`;
            
            // Hide loading overlay
            const loadingOverlay = document.querySelector('.loading-overlay');
            if (loadingOverlay) loadingOverlay.style.display = 'none';
            
            if (currentChartType === 'waterfall') {
                createWaterfallChart();
            } else if (currentChartType === 'pie') {
                createPieChart();
            } else if (currentChartType === 'bar') {
                createBarChart();
            } else if (currentChartType === 'line') {
                createLineChart();
            }
        }
        
        function createWaterfallChart() {
            const data = currentYear === 'both' ? financialData['2024'] : financialData[currentYear];
            
            const waterfallData = {
                type: 'waterfall',
                orientation: 'v',
                measure: ['absolute', 'relative', 'relative', 'relative', 'relative', 'relative', 'total'],
                x: ['Sales', 'COGS', 'Labour', 'Rent', 'Transport', 'Transaction Costs', 'Net Profit'],
                y: [data.sales, -data.cogs, -data.labour, -data.rent, -data.transport, -data.transaction_costs, data.net_profit],
                text: [
                    `KES ${data.sales.toLocaleString()}`,
                    `-KES ${data.cogs.toLocaleString()}`,
                    `-KES ${data.labour.toLocaleString()}`,
                    `-KES ${data.rent.toLocaleString()}`,
                    `-KES ${data.transport.toLocaleString()}`,
                    `-KES ${data.transaction_costs.toLocaleString()}`,
                    `KES ${data.net_profit.toLocaleString()}`
                ],
                textposition: 'outside',
                connector: {line: {color: 'rgb(63, 63, 63)'}},
                increasing: {marker: {color: '#28a745'}},
                decreasing: {marker: {color: '#dc3545'}},
                totals: {marker: {color: '#007bff'}}
            };
            
            const layout = {
                title: `${currentYear} Profit Flow Analysis ${currentYear === '2025' ? '(Updated Transport)' : ''}`,
                showlegend: false,
                template: 'plotly_white',
                height: 400,
                margin: {t: 60, b: 80, l: 80, r: 50},
                xaxis: {tickangle: -45},
                yaxis: {tickformat: ',.0f'}
            };
            
            Plotly.newPlot('dynamicChart', [waterfallData], layout, {responsive: true});
        }
        
        function createPieChart() {
            const data = currentYear === 'both' ? financialData['2024'] : financialData[currentYear];
            
            let labels, values;
            if (currentExpenseFilter === 'operating') {
                labels = ['Labour', 'Rent', 'Transport', 'Transaction Costs'];
                values = [data.labour, data.rent, data.transport, data.transaction_costs];
            } else if (currentExpenseFilter === 'cogs') {
                labels = ['Cost of Goods Sold'];
                values = [data.cogs];
            } else {
                labels = ['COGS', 'Labour', 'Rent', 'Transport', 'Transaction Costs'];
                values = [data.cogs, data.labour, data.rent, data.transport, data.transaction_costs];
            }
            
            const pieData = {
                type: 'pie',
                labels: labels,
                values: values,
                textposition: 'inside',
                textinfo: currentViewMode === 'percentage' ? 'percent' : 'label+percent',
                marker: {
                    colors: ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7'],
                    line: {color: '#FFFFFF', width: 2}
                }
            };
            
            const layout = {
                title: `${currentYear} Expense Distribution ${currentYear === '2025' ? '(Updated Transport)' : ''}`,
                template: 'plotly_white',
                height: 400
            };
            
            Plotly.newPlot('dynamicChart', [pieData], layout, {responsive: true});
        }
        
        function createBarChart() {
            if (currentYear === 'both') {
                // Comparison chart
                const categories = ['Sales', 'Gross Profit', 'Net Profit', 'Operating Expenses'];
                const data2024 = [
                    financialData['2024'].sales,
                    financialData['2024'].gross_profit,
                    financialData['2024'].net_profit,
                    financialData['2024'].total_operating_expenses
                ];
                const data2025 = [
                    financialData['2025'].sales,
                    financialData['2025'].gross_profit,
                    financialData['2025'].net_profit,
                    financialData['2025'].total_operating_expenses
                ];
                
                const trace1 = {
                    x: categories,
                    y: data2024,
                    name: '2024',
                    type: 'bar',
                    marker: {color: '#667eea'}
                };
                
                const trace2 = {
                    x: categories,
                    y: data2025,
                    name: '2025 (Updated)',
                    type: 'bar',
                    marker: {color: '#764ba2'}
                };
                
                const layout = {
                    title: 'Year-over-Year Comparison (2025 Transport Updated)',
                    barmode: 'group',
                    template: 'plotly_white',
                    height: 400,
                    yaxis: {tickformat: ',.0f'}
                };
                
                Plotly.newPlot('dynamicChart', [trace1, trace2], layout, {responsive: true});
            } else {
                // Single year chart
                const data = financialData[currentYear];
                const categories = ['Labour', 'Rent', 'Transport', 'Transaction Costs'];
                const values = [data.labour, data.rent, data.transport, data.transaction_costs];
                
                const barData = {
                    x: categories,
                    y: values,
                    type: 'bar',
                    marker: {color: ['#FF6B6B', '#4ECDC4', '#45B7D1', '#FFEAA7']},
                    text: values.map(v => `KES ${v.toLocaleString()}`),
                    textposition: 'outside'
                };
                
                const layout = {
                    title: `${currentYear} Operating Expenses ${currentYear === '2025' ? '(Updated Transport)' : ''}`,
                    template: 'plotly_white',
                    height: 400,
                    yaxis: {tickformat: ',.0f'}
                };
                
                Plotly.newPlot('dynamicChart', [barData], layout, {responsive: true});
            }
        }
        
        function createLineChart() {
            // Mock trend data for demonstration
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const data2024 = financialData['2024'];
            const data2025 = financialData['2025'];
            
            // Simulate monthly data
            const monthly2024 = months.map((_, i) => data2024.sales / 12 * (0.8 + Math.random() * 0.4));
            const monthly2025 = months.map((_, i) => data2025.sales / 12 * (0.8 + Math.random() * 0.4));
            
            const trace1 = {
                x: months,
                y: monthly2024,
                type: 'scatter',
                mode: 'lines+markers',
                name: '2024 Sales Trend',
                line: {color: '#667eea', width: 3},
                marker: {size: 8}
            };
            
            const trace2 = {
                x: months,
                y: monthly2025,
                type: 'scatter',
                mode: 'lines+markers',
                name: '2025 Sales Trend (Updated)',
                line: {color: '#764ba2', width: 3},
                marker: {size: 8}
            };
            
            const layout = {
                title: 'Monthly Sales Trend Analysis (2025 Updated)',
                template: 'plotly_white',
                height: 400,
                xaxis: {title: 'Month'},
                yaxis: {title: 'Sales (KES)', tickformat: ',.0f'}
            };
            
            const traces = currentYear === 'both' ? [trace1, trace2] : 
                          currentYear === '2024' ? [trace1] : [trace2];
            
            Plotly.newPlot('dynamicChart', traces, layout, {responsive: true});
        }
        
        function populateDataTable() {
            const tbody = document.getElementById('dataTableBody');
            const categories = [
                {name: 'Sales Revenue', key: 'sales', type: 'income'},
                {name: 'Cost of Goods Sold', key: 'cogs', type: 'expense'},
                {name: 'Gross Profit', key: 'gross_profit', type: 'profit'},
                {name: 'Labour', key: 'labour', type: 'expense'},
                {name: 'Rent', key: 'rent', type: 'expense'},
                {name: 'Transport', key: 'transport', type: 'expense'},
                {name: 'Transaction Costs', key: 'transaction_costs', type: 'expense'},
                {name: 'Net Profit', key: 'net_profit', type: 'profit'}
            ];
            
            tbody.innerHTML = '';
            
            categories.forEach(category => {
                const val2024 = financialData['2024'][category.key];
                const val2025 = financialData['2025'][category.key];
                const change = val2025 - val2024;
                const changePercent = val2024 !== 0 ? (change / val2024 * 100) : 0;
                const pct2024 = (val2024 / financialData['2024'].sales * 100);
                const pct2025 = (val2025 / financialData['2025'].sales * 100);
                
                const row = document.createElement('tr');
                if (category.type === 'profit') row.className = 'table-info';
                if (category.type === 'income') row.className = 'table-success';
                
                const isTransport = category.key === 'transport';
                const transportBadge = isTransport ? ' <span class="badge bg-success">Updated</span>' : '';
                
                row.innerHTML = `
                    <td><strong>${category.name}${transportBadge}</strong></td>
                    <td>KES ${val2024.toLocaleString()}</td>
                    <td>KES ${val2025.toLocaleString()}</td>
                    <td class="${change >= 0 ? 'text-success' : 'text-danger'}">
                        ${change >= 0 ? '+' : ''}${changePercent.toFixed(1)}%
                    </td>
                    <td>${pct2024.toFixed(1)}%</td>
                    <td>${pct2025.toFixed(1)}%</td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function resetFilters() {
            document.getElementById('yearSelect').value = '2024';
            document.getElementById('chartTypeSelect').value = 'waterfall';
            document.getElementById('expenseFilter').value = 'all';
            document.getElementById('viewMode').value = 'amount';
            
            currentYear = '2024';
            currentChartType = 'waterfall';
            currentExpenseFilter = 'all';
            currentViewMode = 'amount';
            
            updateDashboard();
        }
    </script>
</body>
</html>